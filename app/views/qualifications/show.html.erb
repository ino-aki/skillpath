<main class="main">
  <div class="inner">
    <div class="qualification-detail">
      <div class="qualification-header">
        <h2><%= @qualification.name %></h2>
      </div>
      
      <div class="tabs">
        <button class="tab-button active" data-tab="basic-info">基本情報</button>
        <button class="tab-button" data-tab="extra-info">詳細情報</button>
        <!-- 学習計画タブを追加 -->
        <button class="tab-button" data-tab="study-plan">学習計画</button>
      </div>
      
      <div class="tab-content active" id="basic-info">
        <div class="qualification-content">
          <hr class="qualification-divider"> <!-- 仕切り線 -->
          <p class="qualification-label">公式URL:</p>
          <p class="qualification-info"><%= link_to @qualification.official_url, @qualification.official_url, target: '_blank', class: 'link-hover' %></p>
          
          <hr class="qualification-divider"> <!-- 仕切り線 -->
          <p class="qualification-label">受験情報URL:</p>
          <p class="qualification-info"><%= link_to @qualification.exam_info_url, @qualification.exam_info_url, target: '_blank', class: 'link-hover' %></p>
          
          <hr class="qualification-divider"> <!-- 仕切り線 -->
          <p class="qualification-label">受験料:</p>
          <p class="qualification-info"><%= @qualification.exam_fee %></p>
        </div>
      </div>
      
      <div class="tab-content" id="extra-info">
        <div class="qualification-extra">
          <hr class="qualification-divider"> <!-- 仕切り線 -->
          <p class="qualification-label">学習目安時間:</p>
          <p class="qualification-info">
            <%= @qualification.study_hours %>時間以上
            (<%= link_to '情報元', @qualification.source_url, target: '_blank', class: 'link-hover' %>)
          </p>
        </div>
      </div>

      <!-- 学習計画タブのコンテンツ -->
      <div class="tab-content" id="study-plan">
        <div class="qualification-study-plan">
          <%= form_with(url: calculate_study_time_study_plans_path, method: :post, id: 'study-plan-form') do |form| %>
            <div class="form-group">
              <%= form.label :start_date, '開始日 ', class: 'form-label' %>
              <%= form.text_field :start_date, class: 'form-control', value: Date.today.strftime('%Y%m%d'), required: true %>
            </div>
            <div class="form-group">
              <%= form.label :test_date, '試験日 ', class: 'form-label' %>
              <%= form.text_field :test_date, class: 'form-control', value: (Date.today + 3.months).strftime('%Y%m%d'), required: true %>
            </div>
            <div class="form-group">
              <%= form.label :holiday_days, '祝日有給日数 ', class: 'form-label' %>
              <%= form.number_field :holiday_days, class: 'form-control', value: 0, required: true %>
            </div>
            <div class="form-group">
              <%= form.label :study_hours_weekday, '平日の1日あたり勉強時間（時間）', class: 'form-label' %>
              <%= form.number_field :study_hours_weekday, class: 'form-control', value: 2, required: true %>
            </div>
            <div class="form-group">
              <%= form.label :study_hours_saturday, '土曜日の1日あたり勉強時間（時間）', class: 'form-label' %>
              <%= form.number_field :study_hours_saturday, class: 'form-control', value: 0, required: true %>
            </div>
            <div class="form-group">
              <%= form.label :study_hours_sunday, '日曜日の1日あたり勉強時間（時間）', class: 'form-label' %>
              <%= form.number_field :study_hours_sunday, class: 'form-control', value: 0, required: true %>
            </div>
            <div class="form-group">
              <%= form.label :study_hours_holiday, '祝日有給日の1日あたり勉強時間（時間）', class: 'form-label' %>
              <%= form.number_field :study_hours_holiday, class: 'form-control', value: 0, required: true %>
            </div>
            <div class="form-group">
              <%= form.label :study_goal_hours, '学習目安時間（時間）', class: 'form-label' %>
              <%= form.number_field :study_goal_hours, class: 'form-control', value: @qualification.study_hours, required: true %>
            </div>
            <%= form.submit '学習計画を計算する', class: 'btn-submit' %>
          <% end %>
          <div id="study-plan-result"></div>
          <div id="study-plan-feedback"></div>
          <p class="study-plan-disclaimer">
            <br>※ こちらの計算結果は目安の学習時間を算出するものであり、実際の受験準備においては個別の状況に応じた適切な計画調整が必要です。ご注意ください。
          </p>
        </div>
      </div>

      <!-- コメントセクション -->
      <div class="comments-section">
        <h3>受験者の声・体験談を投稿</h3>
        <% @comments.each do |comment| %>
          <div class="comment">
            <p><strong><%= link_to comment.user.nickname, user_path(comment.user) %>:</strong> <%= comment.content %></p>
            <p class="timestamp"><%= comment.created_at.strftime("%Y-%m-%d %H:%M") %></p>
            <% if comment.user == current_user %>
              <%= link_to '編集', edit_qualification_comment_path(@qualification, comment) %>
              <%= link_to "削除", qualification_comment_path(@qualification, comment), data: { turbo_method: :delete }, class: :prototype__btn %>
            <% end %>
          </div>
        <% end %>

        <% if user_signed_in? %>
          <!-- コメント入力フォーム -->
          <%= form_with(model: [ @qualification, @comment ], url: qualification_comments_path(@qualification)) do |form| %>
            <%= form.text_area :content, placeholder: 'コメントを入力してください', required: true %>
            <%= form.submit 'コメントを投稿する' %>
          <% end %>
        <% else %>
          <p>コメントをするには<a href="<%= new_user_session_path %>">ログイン</a>してください。</p>
        <% end %>
      </div>

      <div class="disclaimer">
        <p>※ 情報が古い場合があるので受験する場合は公式サイトを参照してください。</p>
      </div>

      <%= link_to '一覧に戻る', qualifications_path, class: 'back-btn' %>
    </div>
  </div>
</main>